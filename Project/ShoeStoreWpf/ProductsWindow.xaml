<Window x:Class="ShoeStoreWpf.ProductsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:swc="clr-namespace:System.Windows.Controls;assembly=PresentationFramework"
        Title="Список товаров" Height="600" Width="1500"
        Background="White" WindowStartupLocation="CenterScreen" Loaded="Window_Loaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка -->
        <StackPanel Orientation="Horizontal" Margin="20">
            <Image Source="/Images/Icon.png" Height="60" />
            <TextBlock x:Name="UserFullName" FontFamily="Times New Roman" FontSize="20" VerticalAlignment="Center" Margin="30,0"/>
        </StackPanel>

        <!-- Фильтры -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="20" VerticalAlignment="Center">
            <TextBlock Text="Поиск по описанию:" FontFamily="Times New Roman" FontSize="14" VerticalAlignment="Center"/>
            <TextBox x:Name="SearchTextBox" Width="200" Margin="10" TextChanged="ApplyFilters"/>

            <TextBlock Text="Производитель:" FontFamily="Times New Roman" FontSize="14" VerticalAlignment="Center" Margin="20,0,0,0"/>
            <ComboBox x:Name="ManufacturerComboBox" Width="180" Margin="10" SelectionChanged="ApplyFilters"/>

            <TextBlock Text="Цена не более:" FontFamily="Times New Roman" FontSize="14" VerticalAlignment="Center" Margin="20,0,0,0"/>
            <TextBox x:Name="MaxPriceTextBox" Width="100" Margin="10" TextChanged="ApplyFilters"/>

            <TextBlock Text="Сортировка:" FontFamily="Times New Roman" FontSize="14" VerticalAlignment="Center" Margin="20,0,0,0"/>
            <ComboBox x:Name="SortComboBox" Width="200" Margin="10" SelectionChanged="ApplyFilters">
                <ComboBoxItem Content="По названию"/>
                <ComboBoxItem Content="По поставщику"/>
                <ComboBoxItem Content="По возрастанию цены"/>
                <ComboBoxItem Content="По по убыванию"/>
            </ComboBox>

            <CheckBox x:Name="OnlyDiscountedCheckBox" Content="Только со скидкой" FontFamily="Times New Roman" Margin="20,0,0,0"
                      Checked="ApplyFilters" Unchecked="ApplyFilters"/>
            <CheckBox x:Name="OnlyInStockCheckBox" Content="Только в наличии" FontFamily="Times New Roman" Margin="20,0,0,0"
                      Checked="ApplyFilters" Unchecked="ApplyFilters"/>
        </StackPanel>

        <!-- Карточки товаров -->
        <ScrollViewer Grid.Row="2" Margin="20">
            <ListBox x:Name="ProductsListBox" SelectionMode="Extended" Background="Transparent" BorderThickness="0">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Black" BorderThickness="1" Margin="20" Padding="20" Width="800">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="180"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Фото — исправлено, теперь точно работает -->
                                <Image>
                                    <Image.Source>
                                        <BitmapImage UriSource="{Binding FullImagePath}" />
                                    </Image.Source>
                                </Image>

                                <!-- Текст -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="30,0">
                                    <TextBlock FontWeight="Bold" FontSize="18" TextWrapping="Wrap">
                                        <Run Text="{Binding CategoryName}"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding Description, StringFormat='Описание товара: {0}'}" TextWrapping="Wrap" Margin="0,10,0,5"/>
                                    <TextBlock Text="{Binding ManufacturerName, StringFormat='Производитель: {0}'}" Margin="0,5"/>
                                    <TextBlock Text="{Binding SupplierName, StringFormat='Поставщик: {0}'}" Margin="0,5"/>

                                    <!-- ЦЕНА — полностью исправлено, Visibility не на Run -->
                                    <TextBlock Margin="0,5" FontFamily="Times New Roman" FontSize="14">
                                        <Run Text="Цена: " />
                                        <!-- Старая цена — красная зачёркнутая, только при скидке -->
                                        <TextBlock Text="{Binding OriginalPrice}" Foreground="Red" TextDecorations="Strikethrough" Visibility="{Binding HasDiscount, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,0,10,0"/>
                                        <!-- Новая цена — всегда жирная -->
                                        <TextBlock Text="{Binding FinalPrice}" FontWeight="Bold"/>
                                    </TextBlock>

                                    <TextBlock Text="{Binding Unit, StringFormat='Единица измерения: {0}'}" Margin="0,5"/>
                                    <TextBlock Text="{Binding Quantity, StringFormat='Количество на складе: {0}'}" Margin="0,5"/>
                                </StackPanel>

                                <!-- Скидка справа -->
                                <Border Grid.Column="2" VerticalAlignment="Top" CornerRadius="8" Background="#2E8B57" Padding="15" Margin="30,0" Visibility="{Binding HasDiscount, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock FontSize="24" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value=""/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasDiscount}" Value="True">
                                                        <Setter Property="Text" Value="{Binding Discount, StringFormat='-{0}%'}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>

        <!-- Админ-панель -->
        <StackPanel x:Name="AdminPanel" Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="20" Visibility="Collapsed">
            <Button Content="Добавить товар" Click="AddButton_Click" Background="#00FA9A" Width="180" Height="45" Margin="15"/>
            <Button Content="Редактировать" Click="EditButton_Click" Background="#00FA9A" Width="140" Height="45" Margin="15"/>
            <Button Content="Удалить" Click="DeleteButton_Click" Background="#00FA9A" Width="140" Height="45" Margin="15"/>
        </StackPanel>
    </Grid>
</Window>